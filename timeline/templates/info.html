{% extends "layout.html" %} {% block body %}
<div class="container">

  <div>
    <h1>{{data_set.name}}</h1>
  </div>

  <div id='information'>
    <h2>Information</h2>
    <ul class="list-group">
      <li class="list-group-item"><b>Description:</b> {{data_set.description}}</li>
      <li class="list-group-item"><b>Datapoints:</b> 1234</li>
      <li class="list-group-item"><b>Number of Samples:</b> 1234</li>
      <li class="list-group-item"><b>Startdate:</b> 1234</li>
      <li class="list-group-item"><b>Enddate:</b> 1234</li>
      <li class="list-group-item"><b>Period:</b> 1234</li>
    </ul>
    </div>

  <div id='time_series_plot'>
    <h2>Time Series Plot</h2>
    <div class='plot_window'>
      <div id='time-plot-canvas' class="plot-canvas"></div>
      <div id='window_params'>

        <div id='first_param'>
        <p>running mean</p>
          <div class="input-group">
            <span class="input-group-addon">
              <input type="checkbox" id="mean_checkbox" onclick="toggleCheckbox(this)" aria-label="...">
            </span>
            <input type="text" id="mean_text" class="form-control" aria-label="...">
          </div><!-- /input-group -->
        </div>

        <div id='second_param'>
        <p>running std.</p>
          <div class="input-group">
            <span class="input-group-addon">
              <input type="checkbox" id="std_checkbox" onclick="toggleCheckbox(this)" aria-label="...">
            </span>
            <input type="text" id="std_text" class="form-control" aria-label="...">
          </div><!-- /input-group -->
        </div>

        <div id='third_param'>
        <p>start date</p>
        <div class="input-group">
          <span class="input-group-addon">
            <input type="checkbox" id="start_checkbox" onclick="toggleCheckbox(this)" aria-label="...">
          </span>
          <input type='text' id="start_date" class="form-control" />
        </div><!-- /input-group -->
        </div>

        <div id='forth_param'>
        <p>end date</p>
          <div class="input-group">
            <span class="input-group-addon">
              <input type="checkbox" id="end_checkbox" onclick="toggleCheckbox(this)" aria-label="...">
            </span>
            <input type='text' id="end_date" class="form-control" />
          </div><!-- /input-group -->
        </div>
        <button type="button" id="btn_update_time_series" class="btn btn-default">Update</button>
      </div>
    </div>
  </div> <!-- time_series_plot -->

  <div id='clear'></div>

  <div id='acf_plot'>
    <h2>ACF Plot</h2>

    <div class='plot_window'>
      <div id='acf-plot-canvas' class="plot-canvas"></div>
      <div id='window_params'>

        <div id='first_param'>
        <p>max lag</p>
          <div class="input-group">
            <span class="input-group-addon">
              <input type="checkbox" id="lag_checkbox" onclick="toggleCheckbox(this)" aria-label="...">
            </span>
            <input type="text" id="lag_text" class="form-control" aria-label="...">
          </div>
        </div>

        <label class="checkbox-inline"><input type="checkbox" value="">scale</label>
        <button type="button" id="btn_update_time_series" class="btn btn-default">Update</button>
      </div>
    </div>

  </div> <!-- acf_plot -->
</div> <!-- /.container -->

<script type="text/javascript">

  function toggleCheckbox(element) {
    if(element.id === "mean_checkbox") {
      $('#mean_text').prop("disabled", !element.checked);
    } else if (element.id === "std_checkbox") {
      $('#std_text').prop("disabled", !element.checked);
    } else if (element.id === "start_checkbox") {
      $('#start_date').prop("disabled", !element.checked);
    } else if (element.id === "end_checkbox") {
      $('#end_date').prop("disabled", !element.checked);
    }
  };

  $('#btn_update_time_series').click( function(event) {
    show_empty_plot('#time-plot-canvas', 'loading');

    var start_date = $("#start_date").data("DateTimePicker").date();
    var end_date = $("#end_date").data("DateTimePicker").date();

    var params = {
      'id': '{{ data_set.id }}',
      'target': '#time-plot-canvas',
      'height': 500
    };

    if(document.getElementById('mean_checkbox').checked) {
      params['rolling_mean_window'] = document.getElementById('mean_text').value;
    }

    if(document.getElementById('std_checkbox').checked) {
      params['rolling_std_window'] = document.getElementById('std_text').value;
    }

    if(document.getElementById('start_checkbox').checked && start_date !== null) {
      params['start_date'] = date_to_unix_time_stamp(start_date.toDate());
    }

    if(document.getElementById('end_checkbox').checked && end_date !== null) {
      params['end_date'] = date_to_unix_time_stamp(end_date.toDate());
    }

    time_plot({'data': params});
  });

  $('#mean_text').prop("disabled", true);
  $('#std_text').prop("disabled", true);
  $('#start_date').prop("disabled", true);
  $('#end_date').prop("disabled", true);

  $('#start_date').datetimepicker();
  $('#end_date').datetimepicker();

  var params = {
    'id': '{{ data_set.id }}',
    'target': '#time-plot-canvas',
    'height': 500
  };

    show_empty_plot('#time-plot-canvas', 'loading');
    time_plot({'data': params});
    show_empty_plot('#acf-plot-canvas', 'loading');
    acf_plot({'data': params}); // TODO: handle params in function correctly
    // and move show empty plot calls into the functions
</script>
{% endblock %}
